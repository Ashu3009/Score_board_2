{% extends "test_1/base.html" %}
{% block content %}
<h1>Admin Control</h1>

<form id="teamForm">
  {% csrf_token %}
  <input type="text" name="team_red_name" placeholder="Red Team" value="{{ state.team_red_name }}">
  <input type="text" name="team_blue_name" placeholder="Blue Team" value="{{ state.team_blue_name }}">
  <button type="submit">Update Teams</button>
</form>

<h2>Timer: <span id="timer">{{ state.game_time }}</span> sec</h2>
<button onclick="sendAction('start')">Start</button>
<button onclick="sendAction('stop')">Stop</button>
<button onclick="sendAction('reset')">Reset</button>

<script>
// Team update
document.getElementById("teamForm").addEventListener("submit", async function(e){
  e.preventDefault();
  let formData = new FormData(this);
  await fetch("/test_1/api/update-teams/", { method:"POST", body:formData });
  alert("Teams updated!");
});

// Timer control
async function sendAction(action){
  let formData = new FormData();
  formData.append("action", action);
  await fetch("/test_1/api/control-timer/", { method:"POST", body:formData });
}

// Countdown interval
setInterval(async function(){
  let res = await fetch("/test_1/api/state/");
  let data = await res.json();
  
  // Timer logic
  if(data.game_running && data.game_time > 0){
    data.game_time -= 1;

    // Update JSON on server
    let formData = new FormData();
    formData.append("action","update_time");
    formData.append("game_time", data.game_time);
    await fetch("/test_1/api/control-timer/", { method:"POST", body:formData });
  }

  document.getElementById("timer").innerText = data.game_time;
}, 1000);
</script>
{% endblock %}
